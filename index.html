<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Word Guesser</title>
    <script type="text/javascript" src="lib/js/require.js"></script>
    <script type="text/javascript" src="lib/js/phaser.min.js"></script>

    <!-- OUR INCLUDES! -->
    <script type="text/javascript" src="js/models/Block.js"></script>
    <script type="text/javascript" src="js/models/BlockGrid.js"></script>
    <script type="text/javascript" src="js/models/BlockManager.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    // Initialize chess js
    function object(o) {
        function F() {}
        F.prototype = o;
        return new F();
    }

    var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update , render: render}),
        blockManager,
            NBLOCKS = 4,
            SPEED = 1,
            score = 0,
            DICTIONARY = [],
            player = 'undefined',
            TIME_TO_SPAWN = 2,
            BLOCK_VELOCITY = 20;

    function preload( ) {

        // JSON
        game.load.text('dictionary', 'assets/json/data.json');

        // IMAGES
        game.load.image('background', 'assets/img/tits.jpg');
        game.load.image('player', 'assets/img/mario.png');


        // AUDIO
        game.load.audio('soundtrack', ['assets/audio/soundtrack.mp3']);

        // FONTS
        game.load.bitmapFont('desyrel', 'assets/bitmapFonts/desyrel.png', 'assets/bitmapFonts/desyrel.xml');
    }

    function create( ) {
        var music, background, player;

        //  We're going to be using physics, so enable the Arcade Physics system
        game.physics.startSystem(Phaser.Physics.ARCADE);

        // Start the music
        music = game.add.audio('soundtrack');
        music.play();

        background = game.cache.getImage('background');
        game.add.sprite(game.world.centerX - (background.width/2), game.world.centerY - (background.height/2), 'background');

        // Add the player
        player = game.cache.getImage('player');
        player = game.add.sprite(game.world.width - (player.width)*0.1, game.world.centerY - (player.height/2)*0.1, 'player');
        player.scale.setTo(0.1, 0.1);

        // LOAD THE DICTIONARY
        DICTIONARY = JSON.parse(game.cache.getText('dictionary')).easy;


        // INIT THE LOGIC

        blockManager = new BlockManager();
        blockManager.initializeBlockGrid(NBLOCKS, game.world.height);

        game.time.events.add(Phaser.Timer.SECOND * TIME_TO_SPAWN,addBlock, this);
    }

    function update( ) {
        // Update the times since last block
        blockManager.updateTimes();

    }

    function render () {

    }
    function addBlock() {
        var block = blockManager.addBlock();

        var element = game.add.bitmapText(0, blockManager.blockGrids[block.blockGridId].position, 'desyrel', block.text, 32);
        game.physics.arcade.enable(element);
        element.body.velocity.setTo(BLOCK_VELOCITY, 0);

        block.element = element;

        blockManager.blockGrids[block.blockGridId].timeSinceLastBlock = 0;

        game.time.events.add(Phaser.Timer.SECOND * TIME_TO_SPAWN, addBlock, this);
    }


</script>

</body>
</html>